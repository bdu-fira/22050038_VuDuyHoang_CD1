<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Giá» HÃ ng - BÃ¡n Quáº§n Ão</title>
  <link rel="stylesheet" href="./css/cart.css" />
</head>

<body>
  <script src="config.js"></script>
  <header class="header">
    <div class="container header-container">
      <div class="logo">
        ğŸ›ï¸ <span>Shop Quáº§n Ão</span>
      </div>
      <nav>
        <ul class="nav-links" id="nav-links"></ul>
      </nav>
    </div>
  </header>

  <main>
    <h1 class="main-heading">Giá» HÃ ng</h1>

    <div class="cart-container">
      <div id="cart-items"></div>

      <div class="checkout-container">
        <div id="total-price" class="cart-total">Tá»•ng: 0 VNÄ</div>
        <button id="checkout" class="checkout-btn">Thanh ToÃ¡n</button>
      </div>
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const navLinks = document.getElementById('nav-links');
      const userRaw = localStorage.getItem('user');
      let userData = null;
      try {
        userData = userRaw ? JSON.parse(userRaw) : null;
      } catch (e) {
        console.error('Lá»—i parse user:', e);
        localStorage.removeItem('user');
      }

      const cartRaw = localStorage.getItem('cart');
      let cart = [];
      try {
        cart = cartRaw ? JSON.parse(cartRaw) : [];
      } catch (e) {
        console.error('Lá»—i parse cart:', e);
        localStorage.removeItem('cart');
      }

      // TÃ­nh tá»•ng sá»‘ lÆ°á»£ng sáº£n pháº©m trong giá» hÃ ng
      const cartCount = cart.reduce((total, item) => total + (item.quantity || 0), 0);

      if (userData?.user?.khachHang?.hoTen) {
        const hoTen = userData.user.khachHang.hoTen;

        navLinks.innerHTML = `
      <li><a href="index.html">Trang Chá»§</a></li>
      <li><span>ğŸ‘¤ Xin chÃ o, ${hoTen}</span></li>
      <li><a href="#" id="logout-btn">ÄÄƒng Xuáº¥t</a></li>
      <li><a href="cart.html">ğŸ›’ Giá» HÃ ng (<span id="cart-count">${cartCount}</span>)</a></li>
      <li><a href="donhang.html">ÄÆ¡n HÃ ng</a></li>
    `;

        document.getElementById('logout-btn').addEventListener('click', () => {
          localStorage.removeItem('user');
          localStorage.removeItem('token');
          location.reload();
          window.location.href = 'index.html';
        });
      } else {
        navLinks.innerHTML = `
      <li><a href="index.html">Trang Chá»§</a></li>
      <li><a href="login.html">ÄÄƒng Nháº­p</a></li>
      <li><a href="register.html">ÄÄƒng KÃ½</a></li>
      <li><a href="cart.html">ğŸ›’ Giá» HÃ ng (<span id="cart-count">${cartCount}</span>)</a></li>
    `;
      }
    });

  </script>
  <script type="module" src="./js/cart.js"></script>
</body>

</html>